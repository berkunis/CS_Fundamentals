<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Bubble Sort Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Visualization & Content Choices:
        - Introduction (Slides 2,3): Goal: Inform. Method: Formatted text, pseudocode. Interaction: Reading. Justification: Foundational concepts.
        - Language Deep Dive (Slides 4,5,6): Goal: Inform/Compare. Method: Button-selected content (text, code snippets). Interaction: Select language. Justification: Focused study.
        - Comparative Analysis (Slides 7-11): Goal: Compare. Method: Button-selected categories, text comparison. Interaction: Select category. Justification: Point-by-point comparison.
        - Summary Table (Slide 12): Goal: Compare/Summarize. Method: HTML table. Interaction: Reading. Justification: Effective summary.
        - Visualize: Goal: Illustrate Algorithm. Method: Interactive bar chart (Chart.js on Canvas) showing Bubble Sort steps. User input for array, sort/reset controls. Interaction: Input array, click buttons. Justification: Dynamic visual understanding of the algorithm.
        - Takeaways & Conclusion (Slides 13,14): Goal: Inform/Summarize. Method: Formatted text. Interaction: Reading. Justification: Concluding thoughts.
        - Library/Method: HTML, Tailwind CSS, Vanilla JS, Chart.js. NO SVG/Mermaid.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-button {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .tab-button.active {
            background-color: #3B82F6; /* blue-500 */
            color: white;
        }
        .tab-button:not(.active):hover {
            background-color: #DBEAFE; /* blue-100 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .code-block {
            background-color: #1E293B; /* slate-800 */
            color: #E2E8F0; /* slate-200 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.875rem; /* text-sm */
        }
        .code-block code {
            white-space: pre;
        }
        .comparison-button.active {
            background-color: #10B981; /* emerald-500 */
            color: white;
        }
        .comparison-button:not(.active):hover {
            background-color: #A7F3D0; /* emerald-100 */
        }
         .language-button.active {
            background-color: #6366F1; /* indigo-500 */
            color: white;
        }
        .language-button:not(.active):hover {
            background-color: #C7D2FE; /* indigo-100 */
        }
        table th, table td {
            border: 1px solid #D1D5DB; /* gray-300 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Max width for the chart */
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Base height */
            max-height: 400px; /* Max height */
            background-color: #F9FAFB; /* gray-50 for contrast */
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06);
        }
        @media (min-width: 768px) { /* md breakpoint */
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col items-center pt-6 sm:pt-10 pb-10 px-4">

    <div class="container mx-auto max-w-5xl bg-white shadow-xl rounded-lg p-6 sm:p-8">
        <header class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Bubble Sort: A Comparative Look</h1>
            <p class="text-slate-600 mt-2 text-sm sm:text-base">Implementations in Python, C, and Java – Understanding Differences and Trade-offs</p>
            <p class="text-slate-500 mt-2 text-xs sm:text-sm">By Dr. Isil Berkun, Clark College</p>
        </header>

        <nav class="mb-8">
            <ul class="flex flex-wrap justify-center border-b border-slate-300 pb-2">
                <li><button class="tab-button active py-2 px-4 sm:px-6 rounded-t-md text-sm sm:text-base font-medium" onclick="showSection('introduction')">Introduction</button></li>
                <li><button class="tab-button py-2 px-4 sm:px-6 rounded-t-md text-sm sm:text-base font-medium" onclick="showSection('deepDive')">Language Deep Dive</button></li>
                <li><button class="tab-button py-2 px-4 sm:px-6 rounded-t-md text-sm sm:text-base font-medium" onclick="showSection('comparison')">Comparative Analysis</button></li>
                <li><button class="tab-button py-2 px-4 sm:px-6 rounded-t-md text-sm sm:text-base font-medium" onclick="showSection('visualize')">Visualize</button></li>
                <li><button class="tab-button py-2 px-4 sm:px-6 rounded-t-md text-sm sm:text-base font-medium" onclick="showSection('conclusion')">Takeaways & Conclusion</button></li>
            </ul>
        </nav>

        <main>
            <section id="introduction" class="content-section active">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">What is Bubble Sort?</h2>
                <p class="mb-3 text-slate-600 leading-relaxed">This section introduces the fundamental concepts of the Bubble Sort algorithm, including its mechanism, educational value, and inherent efficiency limitations. Understanding these basics is key before diving into specific language implementations.</p>
                <div class="space-y-4 bg-slate-50 p-4 rounded-md">
                    <p><strong>Concept:</strong> A simple comparison-based sorting algorithm.</p>
                    <p><strong>Mechanism:</strong> Repeatedly steps through the list, compares adjacent elements, and swaps them if they are in the wrong order. The pass through the list is repeated until no swaps are needed, indicating that the list is sorted.</p>
                    <p><strong>Educational Value:</strong> Excellent for teaching basic sorting concepts and for comparing language features due to its straightforward logic.</p>
                    <p><strong>Efficiency:</strong> Not efficient for large datasets.
                        <ul class="list-disc list-inside ml-4 mt-1">
                            <li>Time Complexity: O(n²) in average and worst cases.</li>
                            <li>Best Case (already sorted with optimization): O(n).</li>
                        </ul>
                    </p>
                </div>
                <h3 class="text-xl font-semibold mt-6 mb-3 text-slate-700">The Core Logic (Conceptual)</h3>
                <div class="code-block"><code>procedure bubbleSort(List A)
  n = length(A)
  repeat
    swapped = false
    for i = 1 to n-1 inclusive do
      if A[i-1] > A[i] then
        swap(A[i-1], A[i])
        swapped = true
      end if
    end for
    n = n - 1 // Optimization: last element is now in place
  until not swapped
end procedure</code></div>
                <ul class="list-disc list-inside mt-4 space-y-1 text-slate-600">
                    <li><strong>Outer Loop:</strong> Ensures each element "bubbles up" to its correct position.</li>
                    <li><strong>Inner Loop:</strong> Performs the adjacent comparisons and swaps.</li>
                    <li><strong>`swapped` flag:</strong> Optimization to terminate early if the list becomes sorted.</li>
                </ul>
            </section>

            <section id="deepDive" class="content-section">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Language Implementation Deep Dive</h2>
                <p class="mb-6 text-slate-600 leading-relaxed">Explore the nuances of implementing Bubble Sort in Python, C, and Java. Select a language below to view its specific highlights, including code snippets, syntax characteristics, and key pros/cons related to this algorithm.</p>
                <div class="flex flex-wrap justify-center gap-2 mb-6">
                    <button class="language-button active py-2 px-4 rounded-md text-sm sm:text-base font-medium" onclick="showLanguage('python')">Python</button>
                    <button class="language-button py-2 px-4 rounded-md text-sm sm:text-base font-medium" onclick="showLanguage('c')">C</button>
                    <button class="language-button py-2 px-4 rounded-md text-sm sm:text-base font-medium" onclick="showLanguage('java')">Java</button>
                </div>
                <div id="pythonContent" class="language-content active bg-slate-50 p-4 rounded-md">
                    <h3 class="text-xl font-semibold mb-3 text-indigo-700">Python Highlights</h3>
                    <p><strong>Conciseness:</strong> Python's syntax is very compact.</p>
                    <div class="code-block my-2"><code># Swapping elements
my_list[j], my_list[j+1] = my_list[j+1], my_list[j]</code></div>
                    <p><strong>Dynamic Typing:</strong> No need to declare variable types.</p>
                    <p><strong>Readability:</strong> Often considered highly readable.</p>
                    <p><strong>Pros:</strong> Rapid development, easy to write and understand.</p>
                    <p class="mt-2"><strong>Example Snippet (core logic):</strong></p>
                    <div class="code-block mt-1"><code>n = len(list_to_sort)
for i in range(n):
    swapped = False
    for j in range(0, n - i - 1):
        if list_to_sort[j] > list_to_sort[j+1]:
            list_to_sort[j], list_to_sort[j+1] = list_to_sort[j+1], list_to_sort[j]
            swapped = True
    if not swapped:
        break</code></div>
                </div>
                <div id="cContent" class="language-content hidden bg-slate-50 p-4 rounded-md">
                    <h3 class="text-xl font-semibold mb-3 text-indigo-700">C Highlights</h3>
                    <p><strong>Verbosity:</strong> More explicit code is required.</p>
                    <div class="code-block my-2"><code>// Swapping elements (often a helper function)
void swap(int *xp, int *yp) {
    int temp = *xp;
    *xp = *yp;
    *yp = temp;
}
// In sort: swap(&arr[j], &arr[j+1]);</code></div>
                    <p><strong>Static Typing:</strong> Variable types must be declared.</p>
                    <p><strong>Manual Operations:</strong> Array size calculation, pointer usage.</p>
                    <p><strong>Pros:</strong> Potential for high performance, fine-grained control.</p>
                    <p><strong>Cons:</strong> More complex, higher chance of errors.</p>
                    <p class="mt-2"><strong>Example Snippet (core logic):</strong></p>
                    <div class="code-block mt-1"><code>for (i = 0; i < n - 1; i++) {
    swapped = false;
    for (j = 0; j < n - i - 1; j++) {
        if (arr[j] > arr[j + 1]) {
            swap(&arr[j], &arr[j + 1]);
            swapped = true;
        }
    }
    if (swapped == false) break;
}</code></div>
                </div>
                <div id="javaContent" class="language-content hidden bg-slate-50 p-4 rounded-md">
                    <h3 class="text-xl font-semibold mb-3 text-indigo-700">Java Highlights</h3>
                    <p><strong>Object-Oriented Structure:</strong> Code is typically organized within classes.</p>
                    <div class="code-block my-2"><code>// Swapping elements
int temp = arr[j];
arr[j] = arr[j+1];
arr[j+1] = temp;</code></div>
                    <p><strong>Static Typing:</strong> Explicit type declarations.</p>
                    <p><strong>Boilerplate:</strong> More standard code (class definitions, main method).</p>
                    <p><strong>Pros:</strong> Platform independence (JVM), strong typing, rich ecosystem.</p>
                    <p><strong>Cons:</strong> Can be more verbose than Python for simple tasks.</p>
                    <p class="mt-2"><strong>Example Snippet (core logic):</strong></p>
                    <div class="code-block mt-1"><code>void bubbleSort(int[] arr) {
    int n = arr.length;
    boolean swapped;
    for (int i = 0; i < n - 1; i++) {
        swapped = false;
        for (int j = 0; j < n - i - 1; j++) {
            if (arr[j] > arr[j + 1]) {
                int temp = arr[j];
                arr[j] = arr[j + 1];
                arr[j + 1] = temp;
                swapped = true;
            }
        }
        if (!swapped) break;
    }
}</code></div>
                </div>
            </section>

            <section id="comparison" class="content-section">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Comparative Analysis</h2>
                <p class="mb-6 text-slate-600 leading-relaxed">This section provides a direct comparison of Python, C, and Java across several key aspects. Use the buttons to select a category. The summary table offers a quick overview.</p>
                <div class="flex flex-wrap justify-center gap-2 mb-6">
                    <button class="comparison-button active py-2 px-3 rounded-md text-xs sm:text-sm font-medium" onclick="showComparison('syntax')">Syntax & Readability</button>
                    <button class="comparison-button py-2 px-3 rounded-md text-xs sm:text-sm font-medium" onclick="showComparison('typeSystem')">Type System & Flexibility</button>
                    <button class="comparison-button py-2 px-3 rounded-md text-xs sm:text-sm font-medium" onclick="showComparison('swapping')">Swapping Elements</button>
                    <button class="comparison-button py-2 px-3 rounded-md text-xs sm:text-sm font-medium" onclick="showComparison('performance')">Performance</button>
                    <button class="comparison-button py-2 px-3 rounded-md text-xs sm:text-sm font-medium" onclick="showComparison('errorHandling')">Error Handling</button>
                </div>
                <div id="syntaxComparison" class="comparison-content active bg-slate-50 p-4 rounded-md">
                    <h3 class="text-xl font-semibold mb-3 text-emerald-700">Syntax & Readability</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div><strong>Python:</strong> Most concise. Often "executable pseudocode."</div>
                        <div><strong>C:</strong> Verbose. Lower readability due to low-level details.</div>
                        <div><strong>Java:</strong> Medium verbosity (OOP). Good readability.</div>
                    </div>
                </div>
                <div id="typeSystemComparison" class="comparison-content hidden bg-slate-50 p-4 rounded-md">
                    <h3 class="text-xl font-semibold mb-3 text-emerald-700">Type System & Flexibility</h3>
                     <div class="grid md:grid-cols-3 gap-4">
                        <div><strong>Python (Dynamic):</strong> Highly flexible. Runtime type checking.</div>
                        <div><strong>C (Static):</strong> Less flexible. Type-specific functions.</div>
                        <div><strong>Java (Static):</strong> Moderately flexible. Overloading/Generics.</div>
                    </div>
                </div>
                <div id="swappingComparison" class="comparison-content hidden bg-slate-50 p-4 rounded-md">
                    <h3 class="text-xl font-semibold mb-3 text-emerald-700">Swapping Elements</h3>
                     <div class="grid md:grid-cols-3 gap-4">
                        <div><strong>Python:</strong> <code>a, b = b, a</code></div>
                        <div><strong>C:</strong> Temp var + pointers (helper function).</div>
                        <div><strong>Java:</strong> Temp var.</div>
                    </div>
                </div>
                <div id="performanceComparison" class="comparison-content hidden bg-slate-50 p-4 rounded-md">
                    <h3 class="text-xl font-semibold mb-3 text-emerald-700">Performance</h3>
                    <p class="mb-2"><strong>Algorithm:</strong> O(n²) for all. Dominant for large `n`.</p>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div><strong>C:</strong> Generally fastest (compiled).</div>
                        <div><strong>Java:</strong> Fast (JIT on JVM). Some overhead.</div>
                        <div><strong>Python:</strong> Typically slowest (interpreted).</div>
                    </div>
                </div>
                <div id="errorHandlingComparison" class="comparison-content hidden bg-slate-50 p-4 rounded-md">
                    <h3 class="text-xl font-semibold mb-3 text-emerald-700">Error Handling & Robustness</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div><strong>Python:</strong> Runtime errors (`TypeError`, `IndexError`).</div>
                        <div><strong>C:</strong> Low-level errors (buffer overflows). No auto bounds check.</div>
                        <div><strong>Java:</strong> Compile-time type check. Runtime `ArrayIndexOutOfBoundsException`.</div>
                    </div>
                </div>
                <h3 class="text-xl font-semibold mt-8 mb-3 text-slate-700">Summary Table</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200 border border-slate-300 text-sm">
                        <thead class="bg-slate-200">
                            <tr>
                                <th class="px-4 py-2 text-left font-semibold text-slate-700">Feature</th>
                                <th class="px-4 py-2 text-left font-semibold text-slate-700">Python</th>
                                <th class="px-4 py-2 text-left font-semibold text-slate-700">C</th>
                                <th class="px-4 py-2 text-left font-semibold text-slate-700">Java</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-slate-200">
                            <tr><td class="px-4 py-2 font-medium">Typing</td><td class="px-4 py-2">Dynamic</td><td class="px-4 py-2">Static</td><td class="px-4 py-2">Static</td></tr>
                            <tr><td class="px-4 py-2 font-medium">Verbosity</td><td class="px-4 py-2">Low</td><td class="px-4 py-2">High</td><td class="px-4 py-2">Medium</td></tr>
                            <tr><td class="px-4 py-2 font-medium">Readability</td><td class="px-4 py-2">Generally High</td><td class="px-4 py-2">Can be Lower</td><td class="px-4 py-2">Medium</td></tr>
                            <tr><td class="px-4 py-2 font-medium">Performance</td><td class="px-4 py-2">Slower</td><td class="px-4 py-2">Fastest</td><td class="px-4 py-2">Fast</td></tr>
                            <tr><td class="px-4 py-2 font-medium">Swapping</td><td class="px-4 py-2"><code>a,b = b,a</code></td><td class="px-4 py-2">Temp var + pointers</td><td class="px-4 py-2">Temp var</td></tr>
                            <tr><td class="px-4 py-2 font-medium">Reusability</td><td class="px-4 py-2">High</td><td class="px-4 py-2">Low</td><td class="px-4 py-2">Medium</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="visualize" class="content-section">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Visualize Bubble Sort</h2>
                <p class="mb-3 text-slate-600 leading-relaxed">Watch the Bubble Sort algorithm in action! Enter a comma-separated list of numbers, or use the default. Click "Sort" to see the elements "bubble up" to their correct positions. The bars represent the numbers, and their colors change to indicate comparisons and swaps.</p>
                <div class="flex flex-col sm:flex-row gap-4 mb-4 items-center">
                    <input type="text" id="arrayInput" class="flex-grow p-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 5,1,4,2,8">
                    <div class="flex gap-2">
                        <button id="sortButton" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition-colors">Sort</button>
                        <button id="resetButton" class="bg-slate-500 hover:bg-slate-600 text-white font-semibold py-2 px-4 rounded-md transition-colors">Reset</button>
                    </div>
                </div>
                <div id="visualizerStatus" class="mb-2 text-sm text-slate-600 h-6">Enter an array and click Sort.</div>
                <div class="chart-container">
                    <canvas id="bubbleSortChart"></canvas>
                </div>
            </section>

            <section id="conclusion" class="content-section">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Key Takeaways & Conclusion</h2>
                <p class="mb-6 text-slate-600 leading-relaxed">This final section summarizes the main learning points and reflects on the algorithm's practical use.</p>
                <div class="bg-slate-50 p-4 rounded-md space-y-3">
                    <h3 class="text-xl font-semibold text-slate-700">Key Takeaways for Teaching</h3>
                    <ul class="list-disc list-inside space-y-1">
                        <li><strong>Illustrates Trade-offs:</strong> Productivity (Python) vs. Performance (C). Java as a balance.</li>
                        <li><strong>Highlights Type Systems:</strong> Dynamic vs. Static typing.</li>
                        <li><strong>Shows Language Paradigms:</strong> Procedural, Scripting, OOP.</li>
                        <li><strong>Touches on Memory Management:</strong> Implicit vs. Explicit.</li>
                    </ul>
                    <h3 class="text-xl font-semibold mt-4 text-slate-700">Conclusion on Bubble Sort</h3>
                     <ul class="list-disc list-inside space-y-1">
                        <li><strong>Simplicity:</strong> Easy to understand/implement.</li>
                        <li><strong>Educational Tool:</strong> Great for comparing language differences.</li>
                        <li><strong>Practicality:</strong> Not for large datasets (O(n²)). Prefer Merge/Quick/TimSort.</li>
                        <li><strong>Core Message:</strong> Choose the right language for the task.</li>
                    </ul>
                </div>
            </section>
        </main>
    </div>

    <script>
        let currentSection = 'introduction';
        let currentLanguage = 'python';
        let currentComparison = 'syntax';
        let bubbleSortChartInstance = null;
        let visualizerArray = [];
        let defaultArray = [5, 1, 4, 2, 8, 3, 7, 6];
        let isSorting = false;

        const COLORS = {
            DEFAULT: 'rgba(100, 116, 139, 0.7)', // slate-500
            COMPARE: 'rgba(250, 204, 21, 0.7)',  // yellow-400
            SWAP: 'rgba(59, 130, 246, 0.7)',   // blue-500
            SORTED: 'rgba(16, 185, 129, 0.7)'  // emerald-500
        };

        function showSection(sectionId) {
            document.getElementById(currentSection).classList.remove('active');
            document.querySelector(`.tab-button[onclick="showSection('${currentSection}')"]`).classList.remove('active');
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`.tab-button[onclick="showSection('${sectionId}')"]`).classList.add('active');
            
            currentSection = sectionId;
            if (sectionId === 'visualize' && !bubbleSortChartInstance) {
                setupVisualizer();
            }
        }

        function showLanguage(languageId) {
            document.getElementById(currentLanguage + 'Content').classList.add('hidden');
            document.getElementById(currentLanguage + 'Content').classList.remove('active');
            document.querySelector(`.language-button[onclick="showLanguage('${currentLanguage}')"]`).classList.remove('active');

            document.getElementById(languageId + 'Content').classList.remove('hidden');
            document.getElementById(languageId + 'Content').classList.add('active');
            document.querySelector(`.language-button[onclick="showLanguage('${languageId}')"]`).classList.add('active');
            
            currentLanguage = languageId;
        }

        function showComparison(comparisonId) {
            document.getElementById(currentComparison + 'Comparison').classList.add('hidden');
            document.getElementById(currentComparison + 'Comparison').classList.remove('active');
            document.querySelector(`.comparison-button[onclick="showComparison('${currentComparison}')"]`).classList.remove('active');

            document.getElementById(comparisonId + 'Comparison').classList.remove('hidden');
            document.getElementById(comparisonId + 'Comparison').classList.add('active');
            document.querySelector(`.comparison-button[onclick="showComparison('${comparisonId}')"]`).classList.add('active');

            currentComparison = comparisonId;
        }

        function updateChart(data, backgroundColors, statusText = "Visualizer ready.") {
            if (bubbleSortChartInstance) {
                bubbleSortChartInstance.data.labels = data.map(String);
                bubbleSortChartInstance.data.datasets[0].data = data;
                bubbleSortChartInstance.data.datasets[0].backgroundColor = backgroundColors;
                bubbleSortChartInstance.update('none'); 
            }
            document.getElementById('visualizerStatus').textContent = statusText;
        }
        
        function generateColors(length, highlightIndices = [], color = COLORS.DEFAULT) {
            const colors = Array(length).fill(COLORS.DEFAULT);
            highlightIndices.forEach(indexInfo => {
                 if (indexInfo && typeof indexInfo.index === 'number' && indexInfo.index < length) {
                    colors[indexInfo.index] = indexInfo.color;
                } else if (typeof indexInfo === 'number' && indexInfo < length) {
                     colors[indexInfo] = color;
                }
            });
            return colors;
        }

        async function bubbleSortVisualize() {
            if (isSorting) return;
            isSorting = true;
            document.getElementById('sortButton').disabled = true;
            document.getElementById('resetButton').disabled = true;
            document.getElementById('arrayInput').disabled = true;

            let arr = [...visualizerArray];
            let n = arr.length;
            let swapped;

            for (let i = 0; i < n - 1; i++) {
                swapped = false;
                for (let j = 0; j < n - i - 1; j++) {
                    updateChart(arr, generateColors(n, [{index: j, color: COLORS.COMPARE}, {index: j+1, color: COLORS.COMPARE}]), `Comparing ${arr[j]} and ${arr[j+1]}`);
                    await new Promise(resolve => setTimeout(resolve, 500));

                    if (arr[j] > arr[j + 1]) {
                        updateChart(arr, generateColors(n, [{index: j, color: COLORS.SWAP}, {index: j+1, color: COLORS.SWAP}]), `Swapping ${arr[j]} and ${arr[j+1]}`);
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        let temp = arr[j];
                        arr[j] = arr[j + 1];
                        arr[j + 1] = temp;
                        swapped = true;
                        
                        updateChart(arr, generateColors(n, [{index: j, color: COLORS.SWAP}, {index: j+1, color: COLORS.SWAP}]), `Swapped. Array: ${arr.join(', ')}`);
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } else {
                         updateChart(arr, generateColors(n, [{index: j, color: COLORS.DEFAULT}, {index: j+1, color: COLORS.DEFAULT}]), `${arr[j]} <= ${arr[j+1]}. No swap.`);
                         await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }
                updateChart(arr, generateColors(n, [{index: n - 1 - i, color: COLORS.SORTED}]), `${arr[n - 1 - i]} is sorted.`);
                await new Promise(resolve => setTimeout(resolve, 500));


                if (!swapped) {
                    break; 
                }
            }
            
            const finalColors = Array(n).fill(COLORS.SORTED);
            updateChart(arr, finalColors, "Array is sorted!");
            isSorting = false;
            document.getElementById('sortButton').disabled = false;
            document.getElementById('resetButton').disabled = false;
            document.getElementById('arrayInput').disabled = false;
        }

        function setupVisualizer() {
            const arrayInput = document.getElementById('arrayInput');
            const sortButton = document.getElementById('sortButton');
            const resetButton = document.getElementById('resetButton');
            const ctx = document.getElementById('bubbleSortChart').getContext('2d');

            visualizerArray = [...defaultArray];
            arrayInput.value = visualizerArray.join(',');

            bubbleSortChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: visualizerArray.map(String),
                    datasets: [{
                        label: 'Value',
                        data: visualizerArray,
                        backgroundColor: generateColors(visualizerArray.length),
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0 
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#4B5563' } // gray-600
                        },
                        x: {
                            ticks: { color: '#4B5563' } // gray-600
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            enabled: true,
                            callbacks: {
                                label: function(context) {
                                    return `Value: ${context.parsed.y}`;
                                }
                            }
                        }
                    }
                }
            });
            updateChart(visualizerArray, generateColors(visualizerArray.length));

            sortButton.addEventListener('click', () => {
                const inputText = arrayInput.value;
                const parsedArray = inputText.split(',')
                                          .map(s => parseInt(s.trim(), 10))
                                          .filter(n => !isNaN(n));
                if (parsedArray.length > 0 && parsedArray.length <= 20) { // Limit array size for better visualization
                    visualizerArray = parsedArray;
                    updateChart(visualizerArray, generateColors(visualizerArray.length), "Ready to sort.");
                    bubbleSortVisualize();
                } else if (parsedArray.length > 20) {
                    updateChart(visualizerArray, generateColors(visualizerArray.length), "Error: Max 20 numbers for visualization.");
                } 
                else {
                    updateChart(visualizerArray, generateColors(visualizerArray.length), "Error: Invalid input. Please use comma-separated numbers.");
                }
            });

            resetButton.addEventListener('click', () => {
                if (isSorting) return;
                visualizerArray = [...defaultArray];
                arrayInput.value = visualizerArray.join(',');
                updateChart(visualizerArray, generateColors(visualizerArray.length), "Visualizer reset. Enter an array and click Sort.");
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            showSection('introduction'); 
            showLanguage('python'); 
            showComparison('syntax'); 
            if (currentSection === 'visualize') {
                setupVisualizer();
            }
        });
    </script>

</body>
</html>
